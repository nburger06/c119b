# Toy Model Documentation
### Script: `toymodel.r`

This document describes the spatial logic and equations used in the Congo Basin deforestation simulation.

---

## 0. Initial State Definitions
The model tracks four distinct land-cover states:
1.  **Undisturbed (U)**: Intact primary forest.
2.  **Degraded (D)**: Impacted forest with reduced biomass.
3.  **Deforested (F)**: Land cleared of forest cover.
4.  **Regrown (R)**: Secondary forest or recovering land.

## 1. Global Transition Probability Matrix ($P$)
The base matrix represents "natural" transition probabilities per timestep before human or climate modifiers are applied.

$$
P = \begin{bmatrix}
1.00 & 0.00 & 0.00 & 0.00 \\
0.00 & 0.95 & 0.01 & 0.04 \\
0.00 & 0.01 & 0.99 & 0.00 \\
0.00 & 0.09 & 0.01 & 0.95
\end{bmatrix}
$$



## 2. Time-Dependent Impact Parameters
At each timestep $t$, the model calculates impact coefficients based on human population growth and climate change trends.

* **Relative Population ($h$):** Calculated relative to the initial population $h_0$.
    $$h_t = \frac{h_0 + (hpg \cdot t)}{h_0}$$
* **Warming Constant ($\kappa$):** Represents linear annual warming (based on SSP2-4.5 Intermediate scenario).
    $$\kappa = \frac{1.5}{74} \approx 0.02^\circ C / \text{year}$$

### Coefficient Equations:
The following parameters scale the probability of land-state transitions:
* **$\alpha$ (Deforestation):** $\alpha_t = \alpha_h h_t + \alpha_c \kappa t$
* **$\beta$ (Degradation):** $\beta_t = \beta_h h_t + \beta_c \kappa t$
* **$\gamma$ (Secondary Deforestation):** $\gamma_t = \gamma_h h_t + \gamma_c \kappa t$
* **$\psi$ (Regrowth):** $\psi_t = \psi_h h_t$

## 3. Spatial Logic: `neighbor_frac()`
For any cell, the influence of its surroundings is calculated using a $3 \times 3$ neighborhood. The fraction $f$ of neighbors in state $s$ is:

$$f_s = \frac{\sum_{i=1}^{n} \mathbb{1}(r_i = s)}{\sum_{i=1}^{n} 1}$$



## 4. Probabilistic Modification: `modify_P()`
The transition matrix is updated for every individual cell by "boosting" specific probabilities based on neighborhood composition and time-dependent coefficients.

### Transition Updates:
* **From Undisturbed ($i=1$):**
    * $P'_{1,3} = P_{1,3} + \alpha (f_f + f_d)$ (Deforestation driven by proximity to cleared/degraded land)
    * $P'_{1,2} = P_{1,2} + \beta (f_d + f_f)$ (Degradation/Edge effects)
* **From Degraded ($i=2$):**
    * $P'_{2,3} = P_{2,3} + \gamma f_f$ (Conversion of degraded land to deforested)
    * $P'_{2,4} = P_{2,4} + \psi f_u$ (Regrowth favored by proximity to undisturbed forest)
* **From Deforested ($i=3$):**
    * $P'_{3,4} = P_{3,4} + \psi f_u$ (Recovery favored by proximity to undisturbed forest)

## 5. Normalization
To maintain mathematical integrity (ensure rows sum to 1.0), each row $i$ in the modified matrix $P'$ is rescaled:

$$\pi_{ij} = \frac{P'_{ij}}{\sum_{k=1}^{4} P'_{ik}}$$

The final state for the next timestep is then determined by sampling the distribution $\pi_i$.